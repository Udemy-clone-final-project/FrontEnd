<main class="container my-4">
  <div class="row g-4">
    <!-- Left: Cart Items -->
    <div class="col-lg-8" [class.col-lg-12]="items().length === 0">
      <h2 class="mb-3">Shopping Cart</h2>

      @if(items().length === 0) {
      <div class="text-center py-5 w-100">
        <img src="/images/icons/empty-cart.svg" alt="Empty" width="140" class="mb-3" />
        <p class="mb-0">You don’t have any items in your cart.</p>
        <a [routerLink]="['/home']" class="">Explore RedBubble</a>
      </div>
      } @else {
      <div class="list-group list-group-flush ">
        @for (item of items(); track item.productId) {
        <div class="list-group-item px-0 py-4">
          <div class="d-flex align-items-start gap-4 justify-content-between">
           <a [routerLink]="['/products', item.productId]">
            <img
              [src]="item.images[0] || '/images/products/black-t-shirt.webp'"
              alt="product"
              class="rounded border object-fit-cover"
              width="128"
              height="128"
            />
           </a>
            <div>
              <h6 class="mb-1"><a [routerLink]="['/products', item.productId]">{{ item.title }}</a></h6>
              <div class="text-muted small">
                {{ item.variant.color }}
                <span class="mx-1">•</span>
                {{ item.variant.size }}
              </div>
            </div>

            <div class="btn-group d-flex align-items-center" role="group" aria-label="Quantity">
              <button class="bg-light p-2  rounded-full" (click)="onDec(item)" [disabled]="item.qty === 1">−</button>
              <span class="px-3">{{ item.qty }}</span>
              <button class="bg-light p-2 rounded-full" (click)="onInc(item)">+</button>
            </div>
            <div class="text-end">
              <div class="text-primary fw-semibold">{{ (item.price * item.qty) | currency : (item.currency || 'USD') }}</div>
              <!-- <div class="text-muted small">Each {{ item.price | currency : (item.currency || 'USD') }}</div> -->
            </div>

            <button class="btn btn-sm btn-link text-muted" (click)="onRemove(item)">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>
        }
      </div>

    }
    <!-- Assurance/benefits section (static placeholders) -->
    <div class="row row-cols-1 row-cols-md-2 g-3 mt-4">
      <div class="col">
        <div class="d-flex align-items-start gap-3">
          <i class="bi bi-globe2 fs-3 text-primary"></i>
          <div>
            <div class="fw-semibold">Worldwide Shipping</div>
            <div class="small text-muted">Available as standard or express.</div>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="d-flex align-items-start gap-3">
          <i class="bi bi-shield-lock fs-3 text-primary"></i>
          <div>
            <div class="fw-semibold">Secure Payments</div>
            <div class="small text-muted">100% secure with SSL encryption.</div>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="d-flex align-items-start gap-3">
          <i class="bi bi-leaf "></i>
          <div>
            <div class="fw-semibold">Carbon Neutrality</div>
            <div class="small text-muted">We invest in offset programs.</div>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="d-flex align-items-start gap-3">
          <i class="bi bi-hand-thumbs-up fs-3 text-primary"></i>
          <div>
            <div class="fw-semibold">Super Service</div>
            <div class="small text-muted">Hassle‑free returns and support.</div>
          </div>
        </div>
      </div>
    </div>
    </div>

    @if(items().length > 0) {
      <!-- Right: Summary -->
    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 1rem;">
        <div class="card-body">
          <!-- Delivery (static) -->
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
              <div class="small text-muted">Delivery to</div>
              <div class="fw-semibold">Egypt</div>
            </div>
            <a class="small" href="#">Change</a>
          </div>

          <!-- Shipping options (static UI for now) -->
          <div class="list-group mb-3">
            <label class="list-group-item d-flex align-items-start gap-2">
              <input class="form-check-input mt-1" type="radio" name="shipping" [checked]="shippingType() === 'standard'" (change)="onSelectShipping('standard')">
              <div class="flex-grow-1" (click)="onSelectShipping('standard')">
                <div class="fw-semibold">Standard Shipping</div>
                <div class="small text-muted">Between 25 - 29 September</div>
              </div>
            </label>
            <label class="list-group-item d-flex align-items-start gap-2">
              <input class="form-check-input mt-1" type="radio" name="shipping" [checked]="shippingType() === 'express'" (change)="onSelectShipping('express')">
              <div class="flex-grow-1" (click)="onSelectShipping('express')">
                <div class="fw-semibold">Express Shipping</div>
                <div class="small text-muted">By September 12</div>
              </div>
              <span class="small">{{ shippingCost() | currency:displayCurrency() }}</span>
            </label>
          </div>

          <!-- Coupon Accordion -->
          <div class="accordion mb-3" id="couponAccordion">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingCoupon">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCoupon" aria-expanded="false" aria-controls="collapseCoupon">
                  <i class="bi bi-ticket-perforated me-2 text-primary"></i>
                  Coupon / Gift Card
                </button>
              </h2>
              <div id="collapseCoupon" class="accordion-collapse collapse" aria-labelledby="headingCoupon" data-bs-parent="#couponAccordion">
                <div class="accordion-body">
                  <div class="mb-3">
                    <!--
                      ngModel is not recommended in modern Angular (v16+), especially with standalone components and signals.
                      Instead, use a signal for couponCode and bind with [value] and (input).
                      This is more explicit, type-safe, and compatible with Angular's new reactivity model.
                    -->
                    <input
                      class="form-control form-control-lg coupon-input"
                      type="text"
                      placeholder="Enter code"
                      [value]="couponCode"
                      (input)="couponCode = $any($event.target).value"
                    >
                  </div>
                  <button class="btn btn-sm btn-primary w-100" [disabled]="couponCode.length === 0">Apply</button>
                  <hr>
                  <div class="mb-2 fw-semibold">Member Offers</div>
                  <div class="border rounded p-3 d-flex align-items-center justify-content-between mb-2">
                    <div>Get 25% off your first order</div>
                    <a [routerLink]="['/auth/signup']">Sign Up</a>
                  </div>
                  <div class="small"><a [routerLink]="['/auth/login']">Log in</a> to see if you have any member offers waiting for you.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="mb-2 fw-semibold">Order Summary</div>
          <div class="d-flex justify-content-between small mb-2">
            <span>{{ items().length }} item</span>
            <span>{{ subtotal() | currency:displayCurrency() }}</span>
          </div>
          <div class="d-flex justify-content-between small mb-3">
            <span>{{shippingType() === 'standard' ? 'Standard shipping' : 'Express shipping'}}</span>
            <span>{{ shippingCost() | currency:displayCurrency() }}</span>
          </div>

          <hr>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="fw-semibold">Total</div>
            <div class="h5 mb-0">{{totalWithShipping()  | currency:displayCurrency() }}</div>
          </div>

          <a [routerLink]="['/checkout']" class="btn btn-danger w-100 mb-2">Checkout</a>
          <button class="btn btn-warning w-100"><i class="bi bi-paypal me-1"></i> PayPal</button>
        </div>
      </div>
    </div>
    }
  </div>
</main>
