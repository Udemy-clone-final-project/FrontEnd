<main class="container product-main-section">
  <div class="row">
    <!-- Left Column: Sticky Image Carousel -->
    <div class="col-lg-7">
      <div class="sticky-carousel-container">
        <div
          id="productCarousel"
          class="carousel slide"
          data-bs-interval="false"
        >
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img
                [src]="product()?.images?.[0] || '/images/products/black-t-shirt.webp'"
                class="d-block w-100"
                alt="Product Image 1"
              />
            </div>
            <div class="carousel-item">
              <img
                [src]="product()?.images?.[1] || '/images/products/black-t-shirt.webp'"
                class="d-block w-100"
                alt="Product Image 2"
              />
            </div>
            <div class="carousel-item">
              <img
                [src]="product()?.images?.[2] || '/images/products/black-t-shirt.webp'"
                class="d-block w-100"
                alt="Product Image 3"
              />
            </div>
            <div class="carousel-item">
              <img
                [src]="product()?.images?.[3] || '/images/products/black-t-shirt.webp'"
                class="d-block w-100"
                alt="Product Image 4"
              />
            </div>
          </div>

          <!-- Custom Thumbnail Indicators -->
          <ol class="carousel-indicators-thumbnails">
            <li
              data-bs-target="#productCarousel"
              data-bs-slide-to="0"
              class="active"
            >
              <img
                src="/images/products/black-t-shirt.webp"
                class="d-block w-100"
                alt="Thumbnail 1"
              />
            </li>
            <li data-bs-target="#productCarousel" data-bs-slide-to="1">
              <img
                src="/images/products/black-t-shirt.webp"
                class="d-block w-100"
                alt="Thumbnail 2"
              />
            </li>
            <li data-bs-target="#productCarousel" data-bs-slide-to="2">
              <img
                src="/images/products/black-t-shirt.webp"
                class="d-block w-100"
                alt="Thumbnail 3"
              />
            </li>
            <li data-bs-target="#productCarousel" data-bs-slide-to="3">
              <img
                src="/images/products/black-t-shirt.webp"
                class="d-block w-100"
                alt="Thumbnail 4"
              />
            </li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Right Column: Product Details -->
    <div class="col-lg-5">
      <!-- <p class="text-muted">Tags: star trek, uss enterprise, enterprise, ncc 1701</p> -->

      <!-- Artist -->
      <section class="artist-section mb-3 mb-lg-4">
        <h1>{{ product()?.title }}</h1>
        <p class="author">
          <img
            src="/images/icons/artist-avatar.png"
            class="rounded-circle"
            width="40"
            height="40"
          />
          By <a href="#">{{ product()?.artist?.name }}</a>
        </p>
      </section>

      <!-- Price -->
      <div class="price-section d-flex flex-column mb-3 mb-lg-4">
        <span class="price text-primary">{{
          price() | currency : currency()
        }}</span>
        <span class="price-old text-muted text-decoration-line-through"
          >$29.32 (25% off)</span
        >
      </div>

      <!-- Style -->
      <section class="style-section mb-3 mb-lg-4">
        <header>
          <h2>Style</h2>
          <a
            href="#"
            class="float-end"
            data-bs-toggle="modal"
            data-bs-target="#exploreStylesModal"
            >Explore more styles</a
          >
        </header>

        <a
          class="style-item"
          data-bs-toggle="modal"
          data-bs-target="#exploreStylesModal"
        >
          <img src="/images/products/black-t-shirt.webp" alt="Style 1" />
          <div class="content">
            <h3>{{ product()?.style }}</h3>
            <ul class="tags">
              @for (t of product()?.tags; track t) {
              <li class="tag">{{ t }}</li>
              }
            </ul>
          </div>
        </a>
      </section>

      <!-- Color -->
      <section class="color-section mb-3 mb-lg-4">
        <h2>
          Color
          <span class="text-muted">{{ product()?.colors?.[0]?.name }}</span>
        </h2>

        <div class="color-selector mt-2">
          @for (color of product()?.colors; track color.code; let i = $index) {
          <span
            class="color-dot"
            [class.active]="i === selectedColorIndex()"
            [class.light-color]="color.isLight"
            [style.background-color]="color.code"
            [title]="color.name"
            (click)="selectColor(i)"
          >
            @if(i === selectedColorIndex()) {<i
              class="bi bi-check-lg checkmark"
            ></i
            >}
          </span>
          }
        </div>
        @if(showError() && selectedColorIndex() < 0) {
        <span class="text-danger">Please select a color</span>
        }
      </section>

      <!-- Size -->
      <section class="size-section mb-3 mb-lg-4">
        <header>
          <h2>Size</h2>
          <a href="#" data-bs-toggle="modal" data-bs-target="#sizeGuideModal"
            >View Size Guide</a
          >
        </header>

        <div class="d-flex flex-wrap mt-2">
          @for (s of product()?.sizes; track s) {
          <button
            class="btn btn-light px-3 py-2 rounded-1 me-2 mb-2"
            [class.active]="s === selectedSize()"
            [class.border-danger]="showError() && selectedSize() === s"
            (click)="selectSize(s)"
          >
            {{ s }}
          </button>
          }
        </div>
        @if(showError() && selectedSize() === null) {
        <span class="text-danger">Please select a size</span>
        }
      </section>

      <!-- Print Location -->
      <!-- <section class="print-location-section mb-3 mb-lg-4">
        <header>
          <h2>Print Location</h2>
        </header>

        <div class="d-flex">
          @for (s of product()?.printLocation ?? []; track s.id) {
          <a
            class="btn btn-light me-2 mb-2"
            [class.active]="s === selectedPrintLocation()"
            (click)="selectPrintLocation(s)"
          >
            {{ s.title }}
          </a>
          }
        </div>
      </section> -->

      <button
        class="btn btn-primary w-100 mb-3"
        (click)="addToCart()"
        data-bs-toggle="offcanvas"
        data-bs-target="#cartSideBar"
        aria-controls="cartSideBar"
      >
        <i class="bi bi-cart-plus"></i> Add to Cart
      </button>

      <hr />
      <!-- Delivery and returns -->
      <section class="info-section mb-3 mb-lg-4">
        <div class="d-flex align-items-center gap-3">
          <img
            src="/images/icons/eg.svg"
            width="25"
            alt="delivery"
            class="icon"
          />
          <div class="flex-grow-1">
            <div class="fw-semibold">Delivery</div>
            <div class="small text-muted">
              Express by <strong>26 August</strong>
            </div>
            <div class="small text-muted">
              Standard between <strong>8 - 10 September</strong>
            </div>
            <div class="small">
              Not soon enough?
              <a href="#">Give a digital gift card.</a>
            </div>
          </div>
        </div>
      </section>

      <section class="info-section mb-3 mb-lg-4">
        <hr />
        <div class="d-flex align-items-center gap-3">
          <i class="bi bi-hand-thumbs-up fs-4 icon"></i>
          <div class="flex-grow-1">
            <div class="fw-semibold">Super‑easy returns</div>
            <div class="small text-muted">
              Problem? No problem. We’ll fix it, fast.
            </div>
          </div>
          <i class="bi bi-chevron-right"></i>
        </div>
        <hr />
      </section>
      <!-- Product features -->
      <section class="product-features-section mb-3 mb-lg-4">
        <header class="d-flex justify-content-between align-items-center">
          <h5>Product Features</h5>
          <a href="#">
            <ul class="star-box">
              <li><i class="bi bi-star-fill"></i></li>
              <li><i class="bi bi-star-fill"></i></li>
              <li><i class="bi bi-star-fill"></i></li>
              <li><i class="bi bi-star-fill"></i></li>
              <li><i class="bi bi-star-fill"></i></li>
            </ul>
            4.73 (2355 reviews)</a
          >
        </header>

        <ul class="feature-list">
          <li>The standard, traditional t-shirt for everyday wear</li>
          <li>Classic, generous, boxy fit</li>
          <li>Heavyweight fabric, solid colors are 100% preshrunk cotton</li>
          <li>Male model shown is 6'2" / 188 cm tall and wearing size Large</li>
          <li>
            Primary female model shown is 5'3" / 160 cm tall and wearing size
            Small
          </li>
          <li>
            Secondary Female model shown is 5'9" / 175 cm tall and wearing size
            Medium
          </li>
          <li>
            Washing instructions: Hand or machine wash cold. Do not dry clean,
            bleach, tumble dry or iron on the print
          </li>
          <li>
            The third party printer of this product is evaluated according to
            International Labor Organization standards
          </li>
          <li>
            The printer of this product sources blanks from manufacturers
            committed to improving cotton farming practices with the Better
            Cotton Initiative
          </li>
          <li>
            Since every item is made just for you by your local third-party
            fulfiller, there may be slight variances in the product received
          </li>
        </ul>
      </section>
    </div>
  </div>

  <!-- Also available on -->
  @if(related().length > 0) {
  <app-more-products-section
    [products]="related()" [title]="'Also available on'"
  ></app-more-products-section>
  }

  <!-- Similar categories -->
  <hr />
  <div class="row my-5">
    <div class="col-12">
      <h5>T-Shirts Tags</h5>
      <p>
        <a href="#" class="btn btn-link">star trek t-shirts</a>
        <a href="#" class="btn btn-link">uss enterprise t-shirts</a>
        <!-- ... more tags -->
      </p>
      <h5>All Product Tags</h5>
      <p>
        @for (t of product()?.tags; track t) {
        <a href="#" class="btn btn-link">{{ t }} </a>
        }
      </p>
      <h5>Trending topics</h5>
      <p>
        <a href="#" class="btn btn-link">national left handers day stickers</a>
        <a href="#" class="btn btn-link"
          >colorado aabbits with tentacles stickers</a
        >
        <!-- ... more tags -->
      </p>
    </div>
  </div>
</main>

<!-- Explore Styles Modal -->
<div
  class="modal fade"
  id="exploreStylesModal"
  tabindex="-1"
  aria-labelledby="exploreStylesModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exploreStylesModalLabel">
          Explore More Styles
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          Placeholder for exploring other product styles like hoodies, tank
          tops, etc.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Size Guide Modal -->
<div
  class="modal fade"
  id="sizeGuideModal"
  tabindex="-1"
  aria-labelledby="sizeGuideModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="sizeGuideModalLabel">Size Guide</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <!-- Cleaned up content from user -->
        <div class="text-center">
          <img
            src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27140%27%20height=%2783%27/%3e"
            alt="Size guide icon"
            class="mb-3"
          />
          <h2>Size Guide</h2>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="btn-group w-100">
              <input
                type="radio"
                class="btn-check"
                name="gender"
                id="gender-men"
                autocomplete="off"
                checked
              />
              <label class="btn btn-outline-secondary" for="gender-men"
                >Men</label
              >
              <input
                type="radio"
                class="btn-check"
                name="gender"
                id="gender-women"
                autocomplete="off"
              />
              <label class="btn btn-outline-secondary" for="gender-women"
                >Women</label
              >
            </div>
          </div>
          <div class="col-6">
            <div class="btn-group w-100">
              <input
                type="radio"
                class="btn-check"
                name="units"
                id="units-in"
                autocomplete="off"
                checked
              />
              <label class="btn btn-outline-secondary" for="units-in">IN</label>
              <input
                type="radio"
                class="btn-check"
                name="units"
                id="units-cm"
                autocomplete="off"
              />
              <label class="btn btn-outline-secondary" for="units-cm">CM</label>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <h5>Find your fit</h5>
          <p>Standard fit, order a size up if you prefer a looser fit.</p>
          <!-- Fit indicator can be added here if needed -->
        </div>

        <div class="mt-4">
          <h5>Product Measurements</h5>
          <div class="table-responsive">
            <table class="table table-bordered text-center">
              <thead>
                <tr>
                  <th>Size</th>
                  <th>S</th>
                  <th>M</th>
                  <th>L</th>
                  <th>XL</th>
                  <th>2XL</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Chest</strong></td>
                  <td>18in</td>
                  <td>20in</td>
                  <td>22in</td>
                  <td>24in</td>
                  <td>26in</td>
                </tr>
                <tr>
                  <td><strong>Length</strong></td>
                  <td>28in</td>
                  <td>29in</td>
                  <td>30in</td>
                  <td>31in</td>
                  <td>32in</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-4">
          <h5>How to choose the perfect size</h5>
          <ol>
            <li>Grab your favorite t-shirt and lay it flat.</li>
            <li>
              For the chest, measure 1in under the armpit, from seam to seam.
            </li>
            <li>
              For the length, measure from the top of the shoulder to the bottom
              of the shirt.
            </li>
            <li>Match this information to the size guide.</li>
          </ol>
        </div>
        <small class="text-muted"
          >*Product measurements refer to garment dimensions, not body
          size</small
        >
      </div>
    </div>
  </div>
</div>

<!--Cart sidebar -->
<div
  class="offcanvas offcanvas-end"
  tabindex="-1"
  id="cartSideBar"
  aria-labelledby="cartSideBarLabel"
>
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="cartSideBarLabel"> <i class="bi bi-check-circle-fill text-success"></i> It's in the cart!</h5>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="offcanvas"
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body">
    @if(cart.items().length === 0) {
   <div class="text-center">
    <img src="/images/icons/empty-cart.svg" alt="Empty Cart" width="200">
    <p>Your cart is empty</p>
   </div>
    } @else {
    <div class="cart-items">
      @for(item of cart.items(); track item.productId) {
      <div class="cart-item">
        <div class="d-flex">
          <img
            [src]="item.images[0]"
            alt="Product Image"
            class="img-fluid"
          />
          <div class="cart-item-details ms-3">
            <h6>{{ item.title }}</h6>
            <p class="text-muted mb-1">{{ item.variant.color }}, {{ item.variant.size }}</p>
            <div class="d-flex align-items-center mt-2">
              <button class="btn btn-sm " (click)="updateQuantity(item, -1)">−</button>
              <span class="mx-3">{{ item.qty }}</span>
              <button class="btn btn-sm " (click)="updateQuantity(item, 1)">+</button>
            </div>
          </div>
          <div class="ms-auto text-end">
            <span class="text-muted text-decoration-line-through small">${{ (item.price * 1.12).toFixed(2) }}</span>
            <p class="fw-bold text-primary mb-0">${{ item.price }}</p>
          </div>
          <button class="btn btn-close ms-2" (click)="removeFromCart(item)"></button>
        </div>
      </div>
      }
    </div>
    }
    <hr>
    <section class="subtotal fw-bold d-flex align-items-center justify-content-between"><h2 class="mt-3">Subtotal: </h2>
      <span class=" fs-5">${{ cart.getTotalPrice() }}</span></section>
      <hr>
    <div class="mt-3">
      <button class="btn btn-primary w-100 mb-3" [routerLink]="['/cart']">
        View Cart
      </button>
      <button
        type="button"
        class="btn btn-light w-100"
        data-bs-dismiss="offcanvas"
        aria-label="Close"
      >
        Keep Shopping
      </button>
    </div>
  </div>
</div>
