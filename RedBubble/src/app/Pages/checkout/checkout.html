<main class="container my-4 checkout-page">
  <div class="row g-4">
    <!-- Left: Delivery form -->
    <div class="col-lg-8">
      <div class="card checkout-card">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <span class="step-circle me-2">1</span>
            <h5 class="mb-0">Delivery</h5>
          </div>

          <div class="mb-3">
            <div class="list-group">
              <label class="list-group-item d-flex align-items-start gap-2 shipping-option" [class.active]="selectedShippingType() === 'standard'">
                <input class="form-check-input mt-1" type="radio" name="shipping" [checked]="selectedShippingType() === 'standard'" (change)="selectShipping('standard')">
                <div class="flex-grow-1">
                  <div class="fw-semibold">Standard Shipping</div>
                  <div class="small text-muted">Between 29 September - 1 October</div>
                </div>
                <span class="small">{{ 0 | currency:'USD' }}</span>
              </label>
              <label class="list-group-item d-flex align-items-start gap-2 shipping-option" [class.active]="selectedShippingType() === 'express'">
                <input class="form-check-input mt-1" type="radio" name="shipping" [checked]="selectedShippingType() === 'express'" (change)="selectShipping('express')">
                <div class="flex-grow-1">
                  <div class="fw-semibold">Express Shipping</div>
                  <div class="small text-muted">By September 16</div>
                </div>
                <span class="small">{{ 65.33 | currency:'USD' }}</span>
              </label>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label small text-muted">Email address</label>
            <input class="form-control" type="email" [ngModel]="email()" (ngModelChange)="email.set($event)">
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" [ngModel]="signUpForOffers()" (ngModelChange)="signUpForOffers.set($event)">
            <label class="form-check-label small">Sign me up for special offers</label>
          </div>
          <div class="mb-3">
            <label class="form-label small text-muted">Full name</label>
            <input class="form-control" type="text" [ngModel]="fullName()" (ngModelChange)="fullName.set($event)">
          </div>

          <div class="mb-3">
            <label class="form-label small text-muted">Country or region</label>
            <select class="form-select" [ngModel]="country()" (ngModelChange)="country.set($event)">
              <option>Egypt</option>
              <option>United States</option>
              <option>United Kingdom</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label small text-muted">Address line 1</label>
            <input class="form-control" type="text" placeholder="House number and street name" [ngModel]="addressLine1()" (ngModelChange)="addressLine1.set($event)">
          </div>

          <div class="extra-fields" [class.show]="showExtraAddressFields()">
            <div class="mb-3">
              <label class="form-label small text-muted">Address line 2</label>
              <input class="form-control" type="text" placeholder="Apt, suite, unit, etc. (optional)" [ngModel]="addressLine2()" (ngModelChange)="addressLine2.set($event)">
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label small text-muted">City</label>
                <input class="form-control" type="text" [ngModel]="city()" (ngModelChange)="city.set($event)">
              </div>
              <div class="col-md-3">
                <label class="form-label small text-muted">Province</label>
                <input class="form-control" type="text" [ngModel]="province()" (ngModelChange)="province.set($event)">
              </div>
              <div class="col-md-3">
                <label class="form-label small text-muted">Postal code</label>
                <input class="form-control" type="text" [ngModel]="postalCode()" (ngModelChange)="postalCode.set($event)">
              </div>
            </div>
            <div class="mt-3">
              <label class="form-label small text-muted">Phone number</label>
              <div class="input-group">
                <span class="input-group-text">+20</span>
                <input class="form-control" type="tel" [ngModel]="phoneNumber()" (ngModelChange)="phoneNumber.set($event)">
              </div>
            </div>
          </div>

          <div class="d-flex align-items-center gap-2 mt-4">
            <a routerLink="/cart" class="btn btn-link">Return to cart</a>
            <button class="btn btn-danger btn-continue ms-auto" type="button">Continue to Payment</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right: Summary -->
    <div class="col-lg-4">
      <div class="card checkout-card sticky-top" style="top: 1rem;">
        <div class="card-body">
          <div class="d-flex gap-2 align-items-start">
            <img [src]="firstItem()?.images?.[0] || '/images/products/black-t-shirt.jpg'" width="60" height="60" class="rounded border object-fit-cover">
            <div class="flex-grow-1">
              <div class="fw-semibold">{{ firstItem()?.title || 'Offline' }}</div>
              <div class="small text-muted">{{ firstItem()?.variant?.color }} â€¢ {{ firstItem()?.variant?.size }}</div>
              <div class="small">{{ firstItem()?.qty }} item</div>
            </div>
            <div class="text-end">
              <div class="text-primary">{{ firstItem() ? (firstItem()!.price * firstItem()!.qty) : 0 | currency:'USD' }}</div>
            </div>
          </div>
          <hr>
          <div class="d-flex justify-content-between small mb-2">
            <span>1 item</span>
            <span>{{ subtotal() | currency:'USD' }}</span>
          </div>
          <div class="d-flex justify-content-between small mb-2">
            <span>Standard shipping</span>
            <span>{{ shippingCost() | currency:'USD' }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between align-items-center">
            <div class="fw-semibold">Total</div>
            <div class="h5 mb-0">{{ totalWithShipping() | currency:'USD' }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment section -->
  <div class="row g-4 mt-3">
    <div class="col-lg-8">
      <div class="card checkout-card">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <span class="step-circle me-2">2</span>
            <h5 class="mb-0">Payment</h5>
          </div>

          <!-- Card payment only -->
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label small text-muted">Card number</label>
              <input class="form-control" inputmode="numeric" autocomplete="cc-number" maxlength="23"
                     placeholder="1234 1234 1234 1234"
                     [ngModel]="cardNumber()"
                     (ngModelChange)="onCardNumberChange($event)">
              <div class="form-text text-danger" *ngIf="cardNumber() && !isValidCardNumber(cardNumber())">Enter a valid card number.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label small text-muted">Expiration (MM/YY)</label>
              <input class="form-control" autocomplete="cc-exp" maxlength="5" placeholder="MM/YY"
                     [ngModel]="cardExp()"
                     (ngModelChange)="onCardExpChange($event)">
              <div class="form-text text-danger" *ngIf="cardExp() && !isValidExp(cardExp())">Enter a valid date.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label small text-muted">CVC</label>
              <input class="form-control" inputmode="numeric" autocomplete="cc-csc" maxlength="4" placeholder="CVC"
                     [ngModel]="cardCvc()"
                     (ngModelChange)="onCardCvcChange($event)">
              <div class="form-text text-danger" *ngIf="cardCvc() && !isValidCvc(cardCvc())">Enter a valid CVC.</div>
            </div>
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" [ngModel]="saveCardInfo()" (ngModelChange)="saveCardInfo.set($event)">
                <label class="form-check-label small">Save my information for faster checkout</label>
              </div>
            </div>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" [ngModel]="useShippingForBilling()" (ngModelChange)="useShippingForBilling.set($event)">
            <label class="form-check-label small">Use shipping address for billing</label>
          </div>

          <button class="btn btn-danger btn-continue w-100" type="button" [disabled]="!canPay()" (click)="startPayment()">
            <i class="bi bi-lock-fill me-1"></i> {{ payLabel() }}
          </button>
          <div class="text-center small text-muted mt-2">Secure payment with 256-bit SSL encryption</div>
        </div>
      </div>
    </div>
  </div>
</main>
